<!DOCTYPE html>
<html ng-app="eventApp">
<head>
  <meta charset="UTF-8" />
  <title>Event Management with Participants</title>

  <!-- AngularJS -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>

  <!-- Link to your CSS file -->
  <link rel="stylesheet" href="style.css" />
</head>
<body ng-controller="EventController">

  <h1>ðŸŽ‰ Event Management System</h1>

  <!-- Add Event Form -->
  <form ng-submit="addEvent()" class="form-inline">
    <input type="text" ng-model="newEvent.name" placeholder="Event Name" required />
    <input type="date" ng-model="newEvent.date" required />
    <input type="text" ng-model="newEvent.location" placeholder="Location" required />
    <button type="submit">Add Event</button>
  </form>

  <hr />

  <!-- Events List -->
  <div class="events-list" ng-repeat="event in events track by event.id">
    <div class="event-header">
      <h3>{{ event.name }} <small>({{ event.date }}) - {{ event.location }}</small></h3>
      <button class="delete-btn" ng-click="deleteEvent(event.id)">Delete Event</button>
    </div>

    <!-- Participants Section -->
    <div class="participants-section">
      <h4>Participants</h4>

      <form ng-submit="addParticipant(event.id)" class="form-inline participant-form">
        <input type="text" ng-model="participantInputs[event.id].name" placeholder="Name" required />
        <input type="email" ng-model="participantInputs[event.id].email" placeholder="Email" required />
        <button type="submit">Add Participant</button>
      </form>

      <ul>
        <li ng-repeat="p in participants[event.id] track by p.id">
          {{ p.name }} ({{ p.email }})
          <button class="delete-btn small" ng-click="deleteParticipant(p.id, event.id)">Delete</button>
        </li>
        <li ng-if="!participants[event.id] || participants[event.id].length === 0">
          No participants yet.
        </li>
      </ul>
    </div>
  </div>

  <script>
    angular.module('eventApp', [])
      .controller('EventController', ['$scope', '$http', function($scope, $http) {
        const API_URL = 'http://localhost:3000/events';

        $scope.events = [];
        $scope.newEvent = {};
        $scope.participantInputs = {};
        $scope.participants = {};

        function loadEvents() {
          $http.get(API_URL).then(response => {
            $scope.events = response.data;
            $scope.participants = {};
            $scope.participantInputs = {};
            $scope.events.forEach(event => {
              $scope.participantInputs[event.id] = { name: '', email: '' };
              loadParticipants(event.id);
            });
          }, error => {
            console.error('Error loading events:', error);
          });
        }

        function loadParticipants(eventId) {
          $http.get(`${API_URL}/${eventId}/participants`).then(response => {
            $scope.participants[eventId] = response.data;
          }, error => {
            console.error('Error loading participants:', error);
          });
        }

        $scope.addEvent = function() {
          if (!$scope.newEvent.name || !$scope.newEvent.date || !$scope.newEvent.location) {
            alert('Please fill all event fields');
            return;
          }
          $http.post(API_URL, $scope.newEvent).then(() => {
            $scope.newEvent = {};
            loadEvents();
          }, error => {
            console.error('Error adding event:', error);
          });
        };

        $scope.deleteEvent = function(id) {
          if (!confirm('Are you sure you want to delete this event and all its participants?')) return;
          $http.delete(`${API_URL}/${id}`).then(() => {
            loadEvents();
          }, error => {
            console.error('Error deleting event:', error);
          });
        };

        $scope.addParticipant = function(eventId) {
          const participant = $scope.participantInputs[eventId];
          if (!participant.name || !participant.email) {
            alert('Please enter participant name and email.');
            return;
          }
          $http.post(`${API_URL}/${eventId}/participants`, participant).then(() => {
            $scope.participantInputs[eventId] = { name: '', email: '' };
            loadParticipants(eventId);
          }, error => {
            console.error('Error adding participant:', error);
          });
        };

        $scope.deleteParticipant = function(participantId, eventId) {
          if (!confirm('Delete this participant?')) return;
          $http.delete(`http://localhost:3000/participants/${participantId}`).then(() => {
            loadParticipants(eventId);
          }, error => {
            console.error('Error deleting participant:', error);
          });
        };

        loadEvents();
      }]);
  </script>

</body>
</html>
